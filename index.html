<html>
<head>
  <title>Pick Up</title>
  <link rel="icon" href="images/pickup-logo-32x32.png" sizes="32x32" />
  <link rel="icon" href="images/pickup-logo-192x192.png" sizes="192x192" />
  <link rel="apple-touch-icon-precomposed" href="images/pickup-logo-180x180.png" />
  <link rel="manifest" href="manifest.json">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
  <meta http-equiv="Pragma" content="no-cache" />
  <meta http-equiv="Expires" content="0" />
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" >
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="mobile-web-app-capable" content="yes">

  <script type='text/javascript' src='js/service-workers.js?v=2.0.0-dev-4'></script>
  <script type='text/javascript' src='js/pickup.js?v=2.0.0-dev-4'></script>
  <link rel='stylesheet'  href='css/style.css?v=2.0.0-dev-4' type='text/css' media='all' />

</head>
<body>
  <div id="page-wrapper">
    <header>
      <div id="header">
        <div>
          <h1><a href="#" onclick="showForm();return false">
            <img id=logo alt="Pick-Up" src="images/pickup-logo-180x180.png">
          </a></h1>
        </div>
        <div id=debug></div>
      </div>
    </header>
    <main id="main">
      <div id="display" class="content">
        <div id="fullname">
          <span class="editable name" id=firstname>John</span>
          <span class="editable name" id=lastname>Doe</span>
        </div>
        <div class="editable comment" id=comment>Is it me you're looking for?</div>
      </div>
    </main>
    <footer>
      <div id="footer">
        <a href="https://pickup.contact/">pickup.contact</a> Version 2.0.0-dev-4
        <button id="installButton" style="display: none;">Installer</button>
      </div>
    </footer>
    <dialog id="settingsModal" style="display: none;">
      <label for="title">Titre :</label>
      <input type="text" id="title" name="title">
      <label for="logo">Logo :</label>
      <input type="file" id="logo" name="logo" accept="image/*">
      <label for="bgColor">Couleur d'arrière-plan :</label>
      <input type="color" id="bgColor" name="bgColor">
      <label for="bgImage">Image d'arrière-plan :</label>
      <input type="file" id="bgImage" name="bgImage" accept="image/*">
      <!-- Ajoutez ce bouton à votre boîte de dialogue -->
      <button id="resetSettings">Réinitialiser</button>
      <button id="saveSettings">Enregistrer</button>
    </dialog>
  </div>
  <!-- Ajoutez cette modal à votre HTML -->
  <script type='text/javascript'>
    function showForm() {
      var settingsModal = document.getElementById('settingsModal');
      settingsModal.style.display = 'block';
    }

document.getElementById('logo').addEventListener('click', showForm);
    document.addEventListener('DOMContentLoaded', function() {
      var logoImage = document.getElementById('logo');
      var titleInput = document.getElementById('title');
      var bgColorInput = document.getElementById('bgColor');
      var bgImageInput = document.getElementById('bgImage');
      var saveSettingsButton = document.getElementById('saveSettings');
      var settingsModal = document.getElementById('settingsModal');

      // Load the saved settings from localStorage
      var savedTitle = localStorage.getItem('title');
      var savedLogo = localStorage.getItem('logo');
      var savedBgColor = localStorage.getItem('bgColor');
      var savedBgImage = localStorage.getItem('bgImage');

      logoImage.addEventListener('click', function() {
        settingsModal.style.display = 'block';
      });

      var resetSettingsButton = document.getElementById('resetSettings');

      function updateStyles() {
        var savedTitle = localStorage.getItem('title');
        var savedLogo = localStorage.getItem('logo');
        var savedBgColor = localStorage.getItem('bgColor');
        var savedBgImage = localStorage.getItem('bgImage');

        if (savedTitle) {
          titleInput.value = savedTitle;
        } else {
          titleInput.value = document.title; // Get the current title from the HTML
        }

        if (savedLogo) {
          logoImage.src = savedLogo;
        } else {
          logoImage.src = document.getElementById('logo').src; // Get the current logo from the HTML
        }

        if (savedBgColor) {
          console.log("saved BgColor", savedBgColor);
          document.body.style.backgroundColor = savedBgColor;
        } else {
          savedBgColor = getComputedStyle(document.body).backgroundColor;
          console.log("default BgColor", savedBgColor);
        }

        if (savedBgImage) {
          document.body.style.backgroundImage = 'url(' + savedBgImage + ')';
        } else {
          document.body.style.backgroundImage = document.body.style.backgroundImage; // Get the current background image from the CSS
        }
      }

      updateStyles();

      saveSettingsButton.addEventListener('click', function() {
        // Save the settings to localStorage
        localStorage.setItem('title', titleInput.value);
        localStorage.setItem('logo', logoImage.src);
        localStorage.setItem('bgColor', bgColorInput.value);
        if (bgImageInput.files[0]) {
          var reader = new FileReader();
          reader.onloadend = function() {
            localStorage.setItem('bgImage', reader.result);
            document.body.style.backgroundImage = 'url(' + reader.result + ')';
          }
          reader.readAsDataURL(bgImageInput.files[0]);
        }
        settingsModal.style.display = 'none';

        updateStyles();
      });

      resetSettingsButton.addEventListener('click', function() {
        // Remove the settings from localStorage
        localStorage.removeItem('title');
        if (logoImage.src) {
          localStorage.removeItem('logo');
        }
        localStorage.removeItem('bgColor');
        localStorage.removeItem('bgImage');

        // Reset the form fields
        titleInput.value = '';
        bgColorInput.value = '';
        bgImageInput.value = '';

        // Reset the page styles
        document.body.style.backgroundColor = '';
        document.body.style.backgroundImage = '';

        settingsModal.style.display = 'none';

        updateStyles();
      });
    });
  </script>

</body>
</html>
